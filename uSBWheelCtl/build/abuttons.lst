ARM GAS  /tmp/ccfWxMsh.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 6
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"abuttons.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.comm	btnShiftDw,1,1
  16              		.comm	btnShiftUp,1,1
  17              		.section	.bss.bStartPressedTime,"aw",%nobits
  18              		.align	1
  21              	bStartPressedTime:
  22 0000 0000     		.space	2
  23              		.section	.text.abuttons_init,"ax",%progbits
  24              		.align	1
  25              		.global	abuttons_init
  26              		.syntax unified
  27              		.thumb
  28              		.thumb_func
  29              		.fpu softvfp
  31              	abuttons_init:
  32              	.LFB66:
  33              		.file 1 "Application/aButtons/abuttons.c"
   1:Application/aButtons/abuttons.c **** /*
   2:Application/aButtons/abuttons.c ****  * abuttons.c
   3:Application/aButtons/abuttons.c ****  *
   4:Application/aButtons/abuttons.c ****  *  Created on: FEB 28, 2014
   5:Application/aButtons/abuttons.c ****  *      Author: mircea.patras
   6:Application/aButtons/abuttons.c ****  *
   7:Application/aButtons/abuttons.c ****  *  Description
   8:Application/aButtons/abuttons.c ****  *  	Implements Buttons's application module
   9:Application/aButtons/abuttons.c ****  *
  10:Application/aButtons/abuttons.c ****  *  History
  11:Application/aButtons/abuttons.c ****  *  	FEB 28, 2014 file creation
  12:Application/aButtons/abuttons.c ****  */
  13:Application/aButtons/abuttons.c **** 
  14:Application/aButtons/abuttons.c **** #include "abuttons.h"
  15:Application/aButtons/abuttons.c **** #include "events.h"
  16:Application/aButtons/abuttons.c **** #include "main.h" /*here are defined the gpio pins*/
  17:Application/aButtons/abuttons.c **** #include "stm32f1xx_hal.h"
  18:Application/aButtons/abuttons.c **** 
  19:Application/aButtons/abuttons.c **** /**Exported data*/
  20:Application/aButtons/abuttons.c **** 
  21:Application/aButtons/abuttons.c **** /*gear shift buttons*/
  22:Application/aButtons/abuttons.c **** uint8_t btnShiftDw;
  23:Application/aButtons/abuttons.c **** uint8_t btnShiftUp;
  24:Application/aButtons/abuttons.c **** 
  25:Application/aButtons/abuttons.c **** /**Private date*/
  26:Application/aButtons/abuttons.c **** PRIVATE_DATA UINT16 bStartPressedTime;
  27:Application/aButtons/abuttons.c **** 
ARM GAS  /tmp/ccfWxMsh.s 			page 2


  28:Application/aButtons/abuttons.c **** /**
  29:Application/aButtons/abuttons.c **** * \brief initialise led's control
  30:Application/aButtons/abuttons.c **** */
  31:Application/aButtons/abuttons.c **** void abuttons_init( void )
  32:Application/aButtons/abuttons.c **** {
  34              		.loc 1 32 0
  35              		.cfi_startproc
  36              		@ args = 0, pretend = 0, frame = 0
  37              		@ frame_needed = 1, uses_anonymous_args = 0
  38              		@ link register save eliminated.
  39 0000 80B4     		push	{r7}
  40              	.LCFI0:
  41              		.cfi_def_cfa_offset 4
  42              		.cfi_offset 7, -4
  43 0002 00AF     		add	r7, sp, #0
  44              	.LCFI1:
  45              		.cfi_def_cfa_register 7
  33:Application/aButtons/abuttons.c **** 	/*Note : the button GPIO pin is initialized in gpio.c (generated by CubeMx)*/
  34:Application/aButtons/abuttons.c **** 	bStartPressedTime = 0;
  46              		.loc 1 34 0
  47 0004 064B     		ldr	r3, .L2
  48 0006 0022     		movs	r2, #0
  49 0008 1A80     		strh	r2, [r3]	@ movhi
  35:Application/aButtons/abuttons.c **** 	/*gear shift buttons*/
  36:Application/aButtons/abuttons.c **** 	btnShiftDw = 0u;
  50              		.loc 1 36 0
  51 000a 064B     		ldr	r3, .L2+4
  52 000c 0022     		movs	r2, #0
  53 000e 1A70     		strb	r2, [r3]
  37:Application/aButtons/abuttons.c ****  	btnShiftUp = 0u;
  54              		.loc 1 37 0
  55 0010 054B     		ldr	r3, .L2+8
  56 0012 0022     		movs	r2, #0
  57 0014 1A70     		strb	r2, [r3]
  38:Application/aButtons/abuttons.c **** }
  58              		.loc 1 38 0
  59 0016 00BF     		nop
  60 0018 BD46     		mov	sp, r7
  61              	.LCFI2:
  62              		.cfi_def_cfa_register 13
  63              		@ sp needed
  64 001a 80BC     		pop	{r7}
  65              	.LCFI3:
  66              		.cfi_restore 7
  67              		.cfi_def_cfa_offset 0
  68 001c 7047     		bx	lr
  69              	.L3:
  70 001e 00BF     		.align	2
  71              	.L2:
  72 0020 00000000 		.word	bStartPressedTime
  73 0024 00000000 		.word	btnShiftDw
  74 0028 00000000 		.word	btnShiftUp
  75              		.cfi_endproc
  76              	.LFE66:
  78              		.section	.text.abuttons_manage,"ax",%progbits
  79              		.align	1
  80              		.global	abuttons_manage
ARM GAS  /tmp/ccfWxMsh.s 			page 3


  81              		.syntax unified
  82              		.thumb
  83              		.thumb_func
  84              		.fpu softvfp
  86              	abuttons_manage:
  87              	.LFB67:
  39:Application/aButtons/abuttons.c **** 
  40:Application/aButtons/abuttons.c **** /**
  41:Application/aButtons/abuttons.c **** * \brief 	manages led's
  42:Application/aButtons/abuttons.c **** *		task		:	100ms
  43:Application/aButtons/abuttons.c **** *		description	:	reads status of the input where buttons are connected and updates the status varia
  44:Application/aButtons/abuttons.c **** */
  45:Application/aButtons/abuttons.c **** void abuttons_manage( void )
  46:Application/aButtons/abuttons.c **** {
  88              		.loc 1 46 0
  89              		.cfi_startproc
  90              		@ args = 0, pretend = 0, frame = 0
  91              		@ frame_needed = 1, uses_anonymous_args = 0
  92 0000 80B5     		push	{r7, lr}
  93              	.LCFI4:
  94              		.cfi_def_cfa_offset 8
  95              		.cfi_offset 7, -8
  96              		.cfi_offset 14, -4
  97 0002 00AF     		add	r7, sp, #0
  98              	.LCFI5:
  99              		.cfi_def_cfa_register 7
  47:Application/aButtons/abuttons.c **** 
  48:Application/aButtons/abuttons.c **** 	static UINT8 buttonStatusOld = ABUTTONS_STATUS_OFF;
  49:Application/aButtons/abuttons.c **** 
  50:Application/aButtons/abuttons.c **** 	/*0 == button pressed*/
  51:Application/aButtons/abuttons.c **** 	if (GPIO_PIN_RESET == HAL_GPIO_ReadPin(userButton_GPIO_Port, userButton_Pin) )
 100              		.loc 1 51 0
 101 0004 0221     		movs	r1, #2
 102 0006 2448     		ldr	r0, .L15
 103 0008 FFF7FEFF 		bl	HAL_GPIO_ReadPin
 104 000c 0346     		mov	r3, r0
 105 000e 002B     		cmp	r3, #0
 106 0010 17D1     		bne	.L5
  52:Application/aButtons/abuttons.c **** 	{/*button pressed*/
  53:Application/aButtons/abuttons.c **** 
  54:Application/aButtons/abuttons.c **** 		/*detect button status change*/
  55:Application/aButtons/abuttons.c **** 		if (ABUTTONS_STATUS_OFF == buttonStatusOld)
 107              		.loc 1 55 0
 108 0012 224B     		ldr	r3, .L15+4
 109 0014 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 110 0016 002B     		cmp	r3, #0
 111 0018 03D1     		bne	.L6
  56:Application/aButtons/abuttons.c **** 		{/*button pressed event*/
  57:Application/aButtons/abuttons.c **** 			MACRO_EV_BSTART_PRESSED
 112              		.loc 1 57 0
 113 001a 214B     		ldr	r3, .L15+8
 114 001c 0122     		movs	r2, #1
 115 001e 1A70     		strb	r2, [r3]
 116 0020 0BE0     		b	.L7
 117              	.L6:
  58:Application/aButtons/abuttons.c **** 		}
  59:Application/aButtons/abuttons.c **** 		else
ARM GAS  /tmp/ccfWxMsh.s 			page 4


  60:Application/aButtons/abuttons.c **** 		{/*button was pressed before*/
  61:Application/aButtons/abuttons.c **** 			if ( bStartPressedTime < 20000 ) bStartPressedTime+=100; /*increment timer and TOP it to 20 seco
 118              		.loc 1 61 0
 119 0022 204B     		ldr	r3, .L15+12
 120 0024 1B88     		ldrh	r3, [r3]
 121 0026 44F61F62 		movw	r2, #19999
 122 002a 9342     		cmp	r3, r2
 123 002c 05D8     		bhi	.L7
 124              		.loc 1 61 0 is_stmt 0 discriminator 1
 125 002e 1D4B     		ldr	r3, .L15+12
 126 0030 1B88     		ldrh	r3, [r3]
 127 0032 6433     		adds	r3, r3, #100
 128 0034 9AB2     		uxth	r2, r3
 129 0036 1B4B     		ldr	r3, .L15+12
 130 0038 1A80     		strh	r2, [r3]	@ movhi
 131              	.L7:
  62:Application/aButtons/abuttons.c **** 		}
  63:Application/aButtons/abuttons.c **** 		buttonStatusOld = ABUTTONS_STATUS_ON;
 132              		.loc 1 63 0 is_stmt 1
 133 003a 184B     		ldr	r3, .L15+4
 134 003c 0122     		movs	r2, #1
 135 003e 1A70     		strb	r2, [r3]
 136 0040 0CE0     		b	.L8
 137              	.L5:
  64:Application/aButtons/abuttons.c **** 	}
  65:Application/aButtons/abuttons.c **** 	else
  66:Application/aButtons/abuttons.c **** 	{/*button not pressed*/
  67:Application/aButtons/abuttons.c **** 		/*detect button status change*/
  68:Application/aButtons/abuttons.c **** 		if (ABUTTONS_STATUS_ON == buttonStatusOld)
 138              		.loc 1 68 0
 139 0042 164B     		ldr	r3, .L15+4
 140 0044 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 141 0046 012B     		cmp	r3, #1
 142 0048 05D1     		bne	.L9
  69:Application/aButtons/abuttons.c **** 		{/*button released event*/
  70:Application/aButtons/abuttons.c **** 			MACRO_EV_BSTART_RELEASED
 143              		.loc 1 70 0
 144 004a 154B     		ldr	r3, .L15+8
 145 004c 0022     		movs	r2, #0
 146 004e 1A70     		strb	r2, [r3]
  71:Application/aButtons/abuttons.c **** 			bStartPressedTime = 0;
 147              		.loc 1 71 0
 148 0050 144B     		ldr	r3, .L15+12
 149 0052 0022     		movs	r2, #0
 150 0054 1A80     		strh	r2, [r3]	@ movhi
 151              	.L9:
  72:Application/aButtons/abuttons.c **** 		}
  73:Application/aButtons/abuttons.c **** 		else
  74:Application/aButtons/abuttons.c **** 		{/*button was released before; TODO see if necessary to count the time button is released*/
  75:Application/aButtons/abuttons.c **** 		}
  76:Application/aButtons/abuttons.c **** 
  77:Application/aButtons/abuttons.c **** 		buttonStatusOld = ABUTTONS_STATUS_OFF;
 152              		.loc 1 77 0
 153 0056 114B     		ldr	r3, .L15+4
 154 0058 0022     		movs	r2, #0
 155 005a 1A70     		strb	r2, [r3]
 156              	.L8:
ARM GAS  /tmp/ccfWxMsh.s 			page 5


  78:Application/aButtons/abuttons.c **** 	}
  79:Application/aButtons/abuttons.c **** 
  80:Application/aButtons/abuttons.c **** 	if (GPIO_PIN_RESET == HAL_GPIO_ReadPin(portShiftGear, pinShiftGearDw) )
 157              		.loc 1 80 0
 158 005c 0121     		movs	r1, #1
 159 005e 1248     		ldr	r0, .L15+16
 160 0060 FFF7FEFF 		bl	HAL_GPIO_ReadPin
 161 0064 0346     		mov	r3, r0
 162 0066 002B     		cmp	r3, #0
 163 0068 03D1     		bne	.L10
  81:Application/aButtons/abuttons.c **** 	{/*button pressed*/
  82:Application/aButtons/abuttons.c **** 		btnShiftDw = 1u;
 164              		.loc 1 82 0
 165 006a 104B     		ldr	r3, .L15+20
 166 006c 0122     		movs	r2, #1
 167 006e 1A70     		strb	r2, [r3]
 168 0070 02E0     		b	.L11
 169              	.L10:
  83:Application/aButtons/abuttons.c **** 	}
  84:Application/aButtons/abuttons.c **** 	else
  85:Application/aButtons/abuttons.c **** 	{
  86:Application/aButtons/abuttons.c **** 		btnShiftDw = 0u;
 170              		.loc 1 86 0
 171 0072 0E4B     		ldr	r3, .L15+20
 172 0074 0022     		movs	r2, #0
 173 0076 1A70     		strb	r2, [r3]
 174              	.L11:
  87:Application/aButtons/abuttons.c **** 	}
  88:Application/aButtons/abuttons.c **** 
  89:Application/aButtons/abuttons.c **** 	if (GPIO_PIN_RESET == HAL_GPIO_ReadPin(portShiftGear, pinShiftGearUp) )
 175              		.loc 1 89 0
 176 0078 0221     		movs	r1, #2
 177 007a 0B48     		ldr	r0, .L15+16
 178 007c FFF7FEFF 		bl	HAL_GPIO_ReadPin
 179 0080 0346     		mov	r3, r0
 180 0082 002B     		cmp	r3, #0
 181 0084 03D1     		bne	.L12
  90:Application/aButtons/abuttons.c **** 	{/*button pressed*/
  91:Application/aButtons/abuttons.c **** 		btnShiftUp = 1u;
 182              		.loc 1 91 0
 183 0086 0A4B     		ldr	r3, .L15+24
 184 0088 0122     		movs	r2, #1
 185 008a 1A70     		strb	r2, [r3]
  92:Application/aButtons/abuttons.c **** 	}
  93:Application/aButtons/abuttons.c **** 	else
  94:Application/aButtons/abuttons.c **** 	{
  95:Application/aButtons/abuttons.c **** 		btnShiftUp = 0u;
  96:Application/aButtons/abuttons.c **** 	}
  97:Application/aButtons/abuttons.c **** 
  98:Application/aButtons/abuttons.c **** }
 186              		.loc 1 98 0
 187 008c 02E0     		b	.L14
 188              	.L12:
  95:Application/aButtons/abuttons.c **** 	}
 189              		.loc 1 95 0
 190 008e 084B     		ldr	r3, .L15+24
 191 0090 0022     		movs	r2, #0
ARM GAS  /tmp/ccfWxMsh.s 			page 6


 192 0092 1A70     		strb	r2, [r3]
 193              	.L14:
 194              		.loc 1 98 0
 195 0094 00BF     		nop
 196 0096 80BD     		pop	{r7, pc}
 197              	.L16:
 198              		.align	2
 199              	.L15:
 200 0098 00080140 		.word	1073809408
 201 009c 00000000 		.word	buttonStatusOld.7424
 202 00a0 00000000 		.word	aleds_ledGreenStatus
 203 00a4 00000000 		.word	bStartPressedTime
 204 00a8 000C0140 		.word	1073810432
 205 00ac 00000000 		.word	btnShiftDw
 206 00b0 00000000 		.word	btnShiftUp
 207              		.cfi_endproc
 208              	.LFE67:
 210              		.section	.text.abuttons_getBStartPressedTime,"ax",%progbits
 211              		.align	1
 212              		.global	abuttons_getBStartPressedTime
 213              		.syntax unified
 214              		.thumb
 215              		.thumb_func
 216              		.fpu softvfp
 218              	abuttons_getBStartPressedTime:
 219              	.LFB68:
  99:Application/aButtons/abuttons.c **** 
 100:Application/aButtons/abuttons.c **** /*returns time while Button Start was pressed*/
 101:Application/aButtons/abuttons.c **** UINT16 abuttons_getBStartPressedTime( void )
 102:Application/aButtons/abuttons.c **** {
 220              		.loc 1 102 0
 221              		.cfi_startproc
 222              		@ args = 0, pretend = 0, frame = 0
 223              		@ frame_needed = 1, uses_anonymous_args = 0
 224              		@ link register save eliminated.
 225 0000 80B4     		push	{r7}
 226              	.LCFI6:
 227              		.cfi_def_cfa_offset 4
 228              		.cfi_offset 7, -4
 229 0002 00AF     		add	r7, sp, #0
 230              	.LCFI7:
 231              		.cfi_def_cfa_register 7
 103:Application/aButtons/abuttons.c **** 	return bStartPressedTime;
 232              		.loc 1 103 0
 233 0004 024B     		ldr	r3, .L19
 234 0006 1B88     		ldrh	r3, [r3]
 104:Application/aButtons/abuttons.c **** }
 235              		.loc 1 104 0
 236 0008 1846     		mov	r0, r3
 237 000a BD46     		mov	sp, r7
 238              	.LCFI8:
 239              		.cfi_def_cfa_register 13
 240              		@ sp needed
 241 000c 80BC     		pop	{r7}
 242              	.LCFI9:
 243              		.cfi_restore 7
 244              		.cfi_def_cfa_offset 0
ARM GAS  /tmp/ccfWxMsh.s 			page 7


 245 000e 7047     		bx	lr
 246              	.L20:
 247              		.align	2
 248              	.L19:
 249 0010 00000000 		.word	bStartPressedTime
 250              		.cfi_endproc
 251              	.LFE68:
 253              		.section	.bss.buttonStatusOld.7424,"aw",%nobits
 256              	buttonStatusOld.7424:
 257 0000 00       		.space	1
 258              		.text
 259              	.Letext0:
 260              		.file 2 "Scheduler/aSchTT_types.h"
 261              		.file 3 "Application/aButtons/abuttons.h"
 262              		.file 4 "Application/aLeds/aleds.h"
 263              		.file 5 "/usr/include/newlib/machine/_default_types.h"
 264              		.file 6 "/usr/include/newlib/sys/_stdint.h"
 265              		.file 7 "Drivers/CMSIS/Include/core_cm3.h"
 266              		.file 8 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/system_stm32f1xx.h"
 267              		.file 9 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 268              		.file 10 "/usr/include/newlib/sys/lock.h"
 269              		.file 11 "/usr/include/newlib/sys/_types.h"
 270              		.file 12 "/usr/lib/gcc/arm-none-eabi/7.3.1/include/stddef.h"
 271              		.file 13 "/usr/include/newlib/sys/reent.h"
 272              		.file 14 "Application/aUSB/ausb.h"
 273              		.file 15 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_gpio.h"
ARM GAS  /tmp/ccfWxMsh.s 			page 8


DEFINED SYMBOLS
                            *ABS*:0000000000000000 abuttons.c
                            *COM*:0000000000000001 btnShiftDw
                            *COM*:0000000000000001 btnShiftUp
     /tmp/ccfWxMsh.s:18     .bss.bStartPressedTime:0000000000000000 $d
     /tmp/ccfWxMsh.s:21     .bss.bStartPressedTime:0000000000000000 bStartPressedTime
     /tmp/ccfWxMsh.s:24     .text.abuttons_init:0000000000000000 $t
     /tmp/ccfWxMsh.s:31     .text.abuttons_init:0000000000000000 abuttons_init
     /tmp/ccfWxMsh.s:72     .text.abuttons_init:0000000000000020 $d
     /tmp/ccfWxMsh.s:79     .text.abuttons_manage:0000000000000000 $t
     /tmp/ccfWxMsh.s:86     .text.abuttons_manage:0000000000000000 abuttons_manage
     /tmp/ccfWxMsh.s:200    .text.abuttons_manage:0000000000000098 $d
     /tmp/ccfWxMsh.s:256    .bss.buttonStatusOld.7424:0000000000000000 buttonStatusOld.7424
     /tmp/ccfWxMsh.s:211    .text.abuttons_getBStartPressedTime:0000000000000000 $t
     /tmp/ccfWxMsh.s:218    .text.abuttons_getBStartPressedTime:0000000000000000 abuttons_getBStartPressedTime
     /tmp/ccfWxMsh.s:249    .text.abuttons_getBStartPressedTime:0000000000000010 $d
     /tmp/ccfWxMsh.s:257    .bss.buttonStatusOld.7424:0000000000000000 $d

UNDEFINED SYMBOLS
HAL_GPIO_ReadPin
aleds_ledGreenStatus
